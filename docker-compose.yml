version: "3.9"

services:
  plain-city-parcels:
    build: .
    container_name: plain-city-parcels
    restart: unless-stopped
    ports:
      - "${PORT:-8080}:8080"
    environment:
      TZ: ${TZ:-America/Denver}
      CRON_SCHEDULE: ${CRON_SCHEDULE:-15 2 * * *}
      PORT: 8080
      RUN_ON_STARTUP: ${RUN_ON_STARTUP:-1}
      SEND_TELEGRAM: ${SEND_TELEGRAM:-0}
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN:-}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID:-}
    volumes:
      - ./data:/app/data
      - ./web:/app/web:ro
      - ./scripts:/app/scripts:ro

  plain-city-telegram-bot:
    build: .
    container_name: plain-city-telegram-bot
    restart: unless-stopped
    entrypoint: ["python3", "scripts/telegram_query_bot.py"]
    environment:
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN:-}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID:-}
      ALLOWED_TELEGRAM_USER_IDS: ${ALLOWED_TELEGRAM_USER_IDS:-}
      ALLOWED_TELEGRAM_CHAT_IDS: ${ALLOWED_TELEGRAM_CHAT_IDS:-}
    volumes:
      - ./data:/app/data
      - ./scripts:/app/scripts:ro
